<!DOCTYPE html>
<html>
<head>
  <title>Country co-occurence in U.S. cables</title>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
  html { height: 100% }
  body { height: 100%; margin: 0px; padding: 0px }
  #map_canvas { height: 100% }
</style>
<script type="text/javascript"
    src="http://maps.google.com/maps/api/js?sensor=true">
</script>
<script type="text/javascript">
  var geocoder;
  var map;
  var countries = {
    'Bangladesh': {'coords':[23.687450,90.350899], 'pagerank': 0.005471, 'cables': 2129, 'toptags': ["KCRM (530)","Military Assistance and Sales (453)","Human Rights (939)","Military and Defense Arrangements (497)","Terrorists and Terrorism (428)"], 'conn':[{'coords':[46.710670, 1.718190], 'count':4},{'coords':[12.547730, 104.983856], 'count':4},{'coords':[44.746712, 15.340800], 'count':4},{'coords':[51.164181, 10.454150], 'count':2},{'coords':[37.487598, 139.838287], 'count':2},{'coords':[-3.387910, 29.920389], 'count':1},{'coords':[18.986059, -72.292259], 'count':2},{'coords':[47.161160, 19.504959], 'count':1},{'coords':[27.515499, 90.442268], 'count':11},{'coords':[-28.479330, 24.679930], 'count':1},{'coords':[31.278749, 37.139351], 'count':10},{'coords':[37.167931, -95.845016], 'count':1},{'coords':[8.465020, -11.795930], 'count':5},{'coords':[38.968319, 59.562870], 'count':1},{'coords':[39.072449, 21.845560], 'count':1},{'coords':[59.461479, 108.831779], 'count':6},{'coords':[-1.947070, 29.876381], 'count':2},{'coords':[33.872452, 35.876549], 'count':3},{'coords':[18.205210, 105.451180], 'count':1},{'coords':[44.049809, 20.910789], 'count':2},{'coords':[23.599751, 121.023811], 'count':2},{'coords':[-15.146760, 167.038040], 'count':1},{'coords':[-23.451389, -58.453209], 'count':1},{'coords':[38.957741, 35.431702], 'count':2},{'coords':[7.873950, 80.789711], 'count':24},{'coords':[9.084570, 8.674250], 'count':2},{'coords':[48.665501, 19.701740], 'count':1},{'coords':[40.339600, 127.495216], 'count':10},{'coords':[38.858189, 71.262177], 'count':3},{'coords':[20.814350, 55.859261], 'count':1},{'coords':[13.036590, 101.492500], 'count':18},{'coords':[52.108200, 5.329860], 'count':3},{'coords':[28.394751, 84.127769], 'count':55},{'coords':[30.441851, 69.359703], 'count':52},{'coords':[15.593050, 120.739067], 'count':7},{'coords':[45.946949, 24.980400], 'count':1},{'coords':[56.954681, -98.308968], 'count':3},{'coords':[26.338520, 17.268820], 'count':12},{'coords':[-13.151920, 27.852539], 'count':1},{'coords':[46.813202, 8.223950], 'count':1},{'coords':[24.287849, 55.115898], 'count':4},{'coords':[36.894451, 104.165649], 'count':12},{'coords':[33.930450, 67.678940], 'count':14},{'coords':[33.240520, 43.689850], 'count':17},{'coords':[26.696360, 30.246469], 'count':5},{'coords':[32.420650, 53.682362], 'count':19},{'coords':[-18.777180, 46.854321], 'count':1},{'coords':[-1.781560, -78.106667], 'count':1},{'coords':[6.614040, 20.941759], 'count':1},{'coords':[42.731602, 25.483120], 'count':2},{'coords':[-37.090698, -63.584808], 'count':1},{'coords':[54.314072, -2.230010], 'count':10},{'coords':[12.518350, -69.963989], 'count':1},{'coords':[15.974210, 107.868042], 'count':2},{'coords':[9.624890, -84.253311], 'count':1},{'coords':[40.151340, 47.687069], 'count':1},{'coords':[0.109740, 113.917397], 'count':7},{'coords':[42.503819, 12.573470], 'count':2},{'coords':[7.955010, -1.031820], 'count':1},{'coords':[42.697552, 19.432270], 'count':1},{'coords':[34.814800, 39.056000], 'count':2},{'coords':[41.205540, 74.779900], 'count':1},{'coords':[-0.024350, 37.903950], 'count':1},{'coords':[41.394760, 64.564453], 'count':1},{'coords':[19.257959, 96.682999], 'count':46},{'coords':[17.579750, -3.998830], 'count':3},{'coords':[46.860802, 103.836807], 'count':1},{'coords':[-11.651580, 43.359970], 'count':2},{'coords':[-20.255409, 57.551739], 'count':1},{'coords':[36.448151, 127.850166], 'count':3},{'coords':[6.757850, 73.154762], 'count':3},{'coords':[29.310150, 47.494450], 'count':5},{'coords':[21.006809, -10.950860], 'count':3},{'coords':[47.999249, 66.902290], 'count':2},{'coords':[23.917549, 45.120209], 'count':3},{'coords':[1.365580, 103.827713], 'count':1},{'coords':[13.316640, 30.209490], 'count':6}]},
    'Burkina Faso': {'coords':[12.241840,-1.556760], 'pagerank': 0.003704, 'cables': 208, 'toptags': ["UN Security Council (27)","Human Rights (60)","Foreign Economic Assistance (31)","External Political Relations (142)","Internal Governmental Affairs (96)"], 'conn':[{'coords':[46.710670, 1.718190], 'count':4},{'coords':[8.465020, -11.795930], 'count':1},{'coords':[44.746712, 15.340800], 'count':2},{'coords':[9.147300, 40.493050], 'count':1},{'coords':[37.487598, 139.838287], 'count':2},{'coords':[9.322040, 2.313130], 'count':3},{'coords':[47.696510, 13.345770], 'count':2},{'coords':[-22.344030, 24.680161], 'count':1},{'coords':[9.624890, -84.253311], 'count':2},{'coords':[59.461479, 108.831779], 'count':3},{'coords':[-1.947070, 29.876381], 'count':2},{'coords':[33.872452, 35.876549], 'count':2},{'coords':[23.599751, 121.023811], 'count':1},{'coords':[-23.451389, -58.453209], 'count':1},{'coords':[17.610991, 8.080940], 'count':10},{'coords':[9.084570, 8.674250], 'count':5},{'coords':[6.452420, -9.428590], 'count':3},{'coords':[6.614040, 20.941759], 'count':1},{'coords':[15.460300, 18.738770], 'count':4},{'coords':[26.338520, 17.268820], 'count':7},{'coords':[11.802520, -15.177020], 'count':1},{'coords':[-13.151920, 27.852539], 'count':1},{'coords':[7.546850, -5.547090], 'count':15},{'coords':[36.894451, 104.165649], 'count':2},{'coords':[7.365290, 12.343440], 'count':3},{'coords':[33.930450, 67.678940], 'count':2},{'coords':[26.696360, 30.246469], 'count':2},{'coords':[32.420650, 53.682362], 'count':5},{'coords':[-0.662620, 14.927410], 'count':2},{'coords':[41.152649, 20.170010], 'count':1},{'coords':[-11.941840, 17.907209], 'count':2},{'coords':[-28.479330, 24.679930], 'count':2},{'coords':[54.314072, -2.230010], 'count':1},{'coords':[9.934880, -9.660630], 'count':13},{'coords':[13.445410, -15.311430], 'count':2},{'coords':[-19.013281, 29.146660], 'count':8},{'coords':[15.112300, -23.614759], 'count':2},{'coords':[7.955010, -1.031820], 'count':3},{'coords':[34.814800, 39.056000], 'count':3},{'coords':[31.815411, -7.067000], 'count':5},{'coords':[19.257959, 96.682999], 'count':1},{'coords':[17.579750, -3.998830], 'count':6},{'coords':[12.547730, 104.983856], 'count':2},{'coords':[36.448151, 127.850166], 'count':2},{'coords':[40.339600, 127.495216], 'count':2},{'coords':[14.499450, -14.445550], 'count':2},{'coords':[21.006809, -10.950860], 'count':4},{'coords':[1.377770, 32.287399], 'count':3},{'coords':[23.625740, -101.956253], 'count':2},{'coords':[13.316640, 30.209490], 'count':3}]},
  };
  
  
  function initialize() {
    var myOptions = {
      zoom: 3,
      center: new google.maps.LatLng(45.81802, 5.95587),
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var polyArray = {};
    var markers = new Array();
    map = new google.maps.Map(document.getElementById("map_canvas"),
        myOptions);
    
    k = 0;
    for (var country in countries) {
      var latlng = new google.maps.LatLng(countries[country]['coords'][0], countries[country]['coords'][1]);
      
      pr = 0.15 + (0.35 * countries[country]['pagerank']/0.011636);
      var newIcon = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_spin&chld="+pr+"|0|0000DD|9|b|.");
      
      
      markers.push(new google.maps.Marker({
          map: map, 
          icon: newIcon,
          position: latlng,
          title: country
      }));
      
      var maxconns = 0
      for (i=0;i<countries[country]['conn'].length;i++) {
        if (maxconns < countries[country]['conn'][i]['count'])
          maxconns = countries[country]['conn'][i]['count'];
      }
      
      var thisPolyArray = new Array();
      for (i=0;i<countries[country]['conn'].length;i++) {
        latlng1 = new google.maps.LatLng(countries[country]['conn'][i]['coords'][0], countries[country]['conn'][i]['coords'][1]);
        var tmp = countries[country]['conn'][i]['count'];
        var sCv = 127*((tmp/maxconns))+128;
        var sC = RGB2Color(sCv, 0, 0);
          
        thisPolyArray[i] = new google.maps.Polyline({
            path: [latlng, latlng1],
            strokeColor: sC,
            strokeOpacity: 0.15+tmp/maxconns,
            strokeWeight: 1+Math.ceil(4*tmp/maxconns)
          });
      }
      polyArray[country] = thisPolyArray;
    }
    
    for (j=0;j<markers.length;j++) {
      country = markers[j].title;
      cables  = countries[markers[j].title]['cables'];
      toptags = countries[markers[j].title]['toptags'];
      myAddListener(markers[j], generateContent(country, cables, toptags), polyArray);
    }
  }
  
  
  
  function generateContent(countryName, cables, toptagsList) {
    s = '<ol style="margin:0px 0px 0px 0px; padding-top: 0px; padding-bottom: 0px;">';
    for (i=0;i<toptagsList.length;i++) {
      s += '<li>'+toptagsList[i].replace(' ', '&nbsp;')+'</li>';
    }
    s += '</ol>';
    
    
    return '<div id="content">'+
        '<h1 style="margin-bottom:0px;padding-bottom:0px;">'+countryName+'</h1>'+
        'in '+addCommas(cables)+' ('+(100*cables/251287).toPrecision(2)+'%) cables.'+
        '<p>'+
        // '<p>'+cables+' cables mention this country.<p>'+
        'Top-5 most important tags (tf.idf):'+s+
        '</p>'+
        '</div>';
  }
  
  
  
  function myAddListener(marker, contentString, polyArray) {
    google.maps.event.addListener(marker, 'click', function() {
        // clear map
        for (var c in polyArray) {
          for (i=0;i<polyArray[c].length;i++) {
            polyArray[c][i].setMap(null);
          }
        }
        
        // show connectors for this country
        for (i=0;i<polyArray[marker.title].length;i++) {
          polyArray[marker.title][i].setMap(map);
        }
        
        // show info window
        var infowindow = new google.maps.InfoWindow({
            content: contentString
        });
        
        infowindow.open(map, marker)
    });
  }
  
  
  
  function RGB2Color(r,g,b) {
    return '#' + byte2Hex(r) + byte2Hex(g) + byte2Hex(b);
  }
  
  function byte2Hex(n) {
     var nybHexString = "0123456789ABCDEF";
     return String(nybHexString.substr((n >> 4) & 0x0F,1)) + nybHexString.substr(n & 0x0F,1);
  }
  
  
  
  function addCommas(nStr)
  {
  	nStr += '';
  	x = nStr.split('.');
  	x1 = x[0];
  	x2 = x.length > 1 ? '.' + x[1] : '';
  	var rgx = /(\d+)(\d{3})/;
  	while (rgx.test(x1)) {
  		x1 = x1.replace(rgx, '$1' + ',' + '$2');
  	}
  	return x1 + x2;
  }
</script>
</head>
<body onload="initialize()">
  <div id="map_canvas" style="width:100%; height:100%"></div>
</body>
</html>